<!-- # AvanÃ§ando no uso do Cypress

Como vocÃª jÃ¡ deve ter percebido, o Cypress Ã© um framework de testes automatizados diferenciado.

E agora que vocÃª jÃ¡ conhece o bÃ¡sico, vou te mostrar (algumas) funcionalidades mais avanÃ§adas, sÃ³ pra vocÃª "sentir um gostinho" do que mais o Cypress te deixa fazer.

## Controle o "relÃ³gio" ðŸ• do navegador com os comandos `cy.clock()` e `cy.tick()`

Com a funcinalidade [`cy.clock()`](https://on.cypress.io/clock), vocÃª pode "congelar" ðŸ§Š o relÃ³gio do navegador.

E com a funcionalidade [`cy.tick()`](https://on.cypress.io/tick), vocÃª pode avanÃ§ar no tempo. ðŸ•’

Veja um exemplo:

```js
it('exibe mensagem por 3 segundos', function() {
  cy.clock() // congela o relÃ³gio do navegador

  // (...) // aÃ§Ã£o que dispara algo que exibe uma mensagem por trÃªs segundos

  // (...) // verificaÃ§Ã£o de que a mensagem estÃ¡ visÃ­vel

  cy.tick(3000) // avanÃ§a o relÃ³gio trÃªs segundos (em milissegundos). AvanÃ§o este tempo para nÃ£o perdÃª-lo esperando.

  // (...) // verificaÃ§Ã£o de que a mensagem nÃ£o estÃ¡ mais visÃ­vel
})
```

### ConteÃºdos sugeridos

Em Junho de 2021, gravei um vÃ­deo chamado [Como testar campos de data com Cypress](https://youtu.be/wiDOdfmuR2o), onde fiz uso da funcionalidade `cy.clock()`.

Ficou bem legal e recomendo assitir!

E em MarÃ§o de 2022, escrevi um conteÃºdo chamado [Controle o relÃ³gio do navegador com Cypress](https://talkingabouttesting.com/2022/03/20/controle-o-relogio-do-navegador-com-cypress/). Fica a recomendaÃ§Ã£o tambÃ©m.

### ExercÃ­cio

Nos testes que verificam mensagens (de sucesso e erro), use as funcionalidades `cy.clock()` e `cy.tick()`, para verificar nÃ£o sÃ³ que a mensagem aparece, mas tambÃ©m que desaparece apÃ³s 3 segundos, porÃ©m, sem precisar esperar pelos 3 segundos (ganhando tempo na execuÃ§Ã£o dos testes).

## lodash ([`Cypress._`](https://docs.cypress.io/api/utilities/_))

O [lodash](https://lodash.com) Ã© uma biblioteca famosa no mundo JavaScript, com diversas funÃ§Ãµes utilitÃ¡rias.

E o legal Ã© que o Cypress jÃ¡ empacota o `lodash` junto com ele, atravÃ©s do mÃ³dulo `Cypress._`.

Algumas das minhas funcionalidades favoritas do `._` sÃ£o:

- [`Cypress._.times()`](https://lodash.com/docs/4.17.15#times)

> ðŸ‘¨â€ðŸ« A funcionalidade `_.times()` serve para vocÃª executar uma funÃ§Ã£o de _callback_ um certo nÃºmero de vezes, onde o nÃºmero de vezes Ã© o primeiro argumento, e a funÃ§Ã£o de _callback_ Ã© o segundo.

Por exemplo:

```js
_.times(3, () => {
  console.log('OlÃ¡ Cypress!')
}) // Isso registrarÃ¡ 'OlÃ¡ Cypress!' trÃªs vezes no console.

```

- [`Cypress._.repeat()`](https://lodash.com/docs/4.17.15#repeat)

> ðŸ‘¨â€ðŸ«  A funcionalidade `_.repeat()` serve para repetir uma string um certo nÃºmero de vezes, onde o primeiro argumento Ã© a string a qual deseja-se repetir, e o segundo argumento Ã© quantas vezes tal string deve ser repetida.

Por exemplo:

```js
const repeatedText = _.repeat('lorem ipsum, ', 3)

console.log(repeatedText) // Isso registrarÃ¡ 'lorem ipsum, lorem ipsum, lorem ipsum, ' no console.
```

### ConteÃºdos sugeridos

Escrevi conteÃºdos que fazem uso de ambos os comandos `_.times()` e `_.repeat()`.

- [Como rodar um teste vÃ¡rias vezes com Cypress para provar que ele Ã© estÃ¡vel](https://talkingabouttesting.com/2021/02/06/como-rodar-um-teste-varias-vezes-com-cypress-para-provar-que-ele-e-estavel/)
- [Como â€œsimularâ€ um CTRL+V com Cypress](https://talkingabouttesting.com/2022/02/11/como-simular-um-ctrlv-com-cypress)

Recomendo a leitura.

### ExercÃ­cio extra 1

Experimente a funcionalidade `Cypress._.times()` em algum dos testes, pra entender seu uso e praticar.

> ðŸ™Š Use para rodar um mesmo teste vÃ¡rias vezes.

## Invoque atributos e mÃ©todos de elementos com o comando [`.invoke()`](https://on.cypress.io/invoke)

Vimos o comando `invoke` na aula [Lidando com links que abrem em outra aba](./07.md), para remover o atributo `target` de um elemento, evitando que quando clicado, a pÃ¡gina nÃ£o abra em outra aba.

Dois outros usos do comando `.invoke()` que quero que vocÃª conheÃ§a sÃ£o:

- `.invoke('show')`
- e `.invoke('hide')`

Com o comando `.invoke('show')`, vocÃª pode forÃ§ar a exibiÃ§Ã£o de um elemento HTML que estÃ¡ oculto, com `display: none;`, por exemplo.

E com o comando `.invoke('hide')`, vocÃª pode ocultar um elemento que estÃ¡ sendo exibido.

### ExercÃ­cio extra 2

1. Crie um teste chamado `exibe e oculta as mensagens de sucesso e erro usando .invoke()`
2. ðŸ™Š O teste deve ter a seguinte estrutura:

```js
it('exibe e oculta as mensagens de sucesso e erro usando .invoke()', () => {
  cy.get('.success')
    .should('not.be.visible')
    .invoke('show')
    .should('be.visible')
    .and('contain', 'Mensagem enviada com sucesso.')
    .invoke('hide')
    .should('not.be.visible')
  cy.get('.error')
    .should('not.be.visible')
    .invoke('show')
    .should('be.visible')
    .and('contain', 'Valide os campos obrigatÃ³rios!')
    .invoke('hide')
    .should('not.be.visible')
})

```

3. Execute o novo teste na _Cypress App_ e quando o mesmo passar, siga em frente.

### ExercÃ­cio extra 3

VocÃª tambÃ©m pode invocar (e definir) o valor de um _input_ ou Ã¡rea de texto usando o comando `.invoke` (por exemplo, `cy.get('textarea').invoke('val', 'some-value')` .)

Portanto...

1. Crie um teste chamado `preenche o campo da Ã¡rea de texto usando o comando invoke`.
2. O teste deve utilizar o comando `.invoke()` para preencher o campo da Ã¡rea de texto.

> ðŸ™Š `cy.get('#open-text-area').invoke('val', 'um texto qualquer')`

3. Verifique se o valor realmente persiste no campo.

> ðŸ™Š `.should('have.value', 'um texto qualquer')`

4. Execute o novo teste na _Cypress App_ e quando o mesmo passar, siga em frente.

## [`cy.request()`](https://on.cypress.io/request)

Um dos maiores "poderes" do Cypress Ã© a capacidade de executar comandos Ã  nÃ­vel da rede.

ConheÃ§a o comando `cy.request()`. ðŸ¦¸ðŸ½â€â™‚ï¸

Com o comando `cy.request()`, vocÃª pode executar requisiÃ§Ãµes HTTP Ã  nÃ­vel da rede, economizando tempo na configuraÃ§Ã£o dos testes e focando no que importa quando se trata de testar atravÃ©s da interface grÃ¡fica do usuÃ¡rio (_GUI_).

Se desejar, vocÃª pode atÃ© mesmo usar o comando `cy.request()` para testar APIs [REST](https://en.wikipedia.org/wiki/REST).

### Mais conteÃºdos sugeridos

- [Como testar APIs com Cypress](https://talkingabouttesting.com/2021/02/07/como-verificar-a-estrutura-do-body-de-um-esquema-json-com-cypress/)
- [Como fazer login de forma programÃ¡tica com Cypress](https://talkingabouttesting.com/2021/12/14/como-fazer-login-de-forma-programatica-com-cypress/)
- [cy.request vs. cy.intercept](https://dev.to/walmyrlimaesilv/cy-request-vs-cy-intercept-cmi) (conteÃºdo em inglÃªs)

### ExercÃ­cio extra 4

1. Crie um teste chamado `faz uma requisiÃ§Ã£o HTTP`
2. Tal teste deve fazer uso da funcionalidade `cy.request()`, para fazer uma requisiÃ§Ã£o do tipo `GET`, para a seguinte URL: `https://cac-tat-v3.s3.eu-central-1.amazonaws.com/index.html`
3. Com a resposta da requisiÃ§Ã£o, verifique que o `status` retornou `200`, o `statusText` retornou `OK` e o `body` inclui a _string_ `CAC TAT`
4. Por fim, execute o novo teste na _Cypress App_ e quando o mesmo passar, siga em frente.

> ðŸ‘¨â€ðŸ« Quer saber mais sobre o comando `cy.request()`? Confira o [curso intermediÃ¡rio de Cypress da Escola TAT no Udemy](https://www.udemy.com/course/testes-automatizados-com-cypress-intermediario/?referralCode=F14505FB0076672E51A2).

## Mostre ao mundo o que vocÃª aprendeu

Para mostrar Ã  sua rede profissional o que vocÃª aprendeu atÃ© agora, poste o seguinte no LinkedIn.

> Estou fazendo o curso "Cypress, do Zero Ã  Nuvem" da escola online Talking About Testing, onde aprendi alguns recursos avanÃ§ados do Cypress, como `cy.clock()`, `cy.tick()` , `.invoke()`, `Cypress._` e `cy.request()`.#TalkingAboutTesting #EscolaTAT #CypressDoZeroANuvem #Cypress #CypressAvanÃ§ado

**Obs.:** Lembre-se de me marcar em sua postagem. [Aqui estÃ¡ meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

ParabÃ©ns! Vamos para a [liÃ§Ã£o 13](./13.md). Tenho um Ãºltimo desafio para vocÃª. -->
